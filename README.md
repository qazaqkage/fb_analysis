# Football Analysis Project

## Описание проекта
Проект **Football Analysis** направлен на анализ футбольных матчей с использованием компьютерного зрения. Система автоматически обнаруживает и отслеживает игроков, мяч и арбитров на видео с применением модели YOLO (You Only Look Once) и алгоритмов трекинга (ByteTrack). Дополнительно реализована логика определения принадлежности игроков к командам с помощью кластеризации (KMeans) по цвету футболок, а также рассчитываются ключевые метрики матча:
- **Владение мячом** – процент кадров, в которых каждая команда владеет мячом.
- **Пройденное расстояние** – суммарное расстояние, пройденное игроками (с переводом в километры).
- **Интенсивность матча** – отношение общего пройденного расстояния (в км) к длительности видео (в минутах), выраженное в км/мин.
- **xG (Expected Goals)** – оценка качества ударов (опционально).

Проект включает веб-интерфейс на базе Streamlit, позволяющий:
- Загружать видео для анализа;
- Получать обработанное видео с аннотациями и статистикой;
- Скачивать готовое видео.

## Основные функции и модули
- **Обнаружение объектов:**  
  Использование модели YOLO для определения позиций игроков, мяча и арбитров.
- **Отслеживание объектов:**  
  Алгоритм ByteTrack для устойчивого трекинга объектов между кадрами.
- **Определение принадлежности к командам:**  
  Кластеризация по цвету футболок с использованием KMeans.
- **Калибровка и трансформация:**  
  Применение оптического потока и перспективного преобразования для получения «реальных» координат и расчёта перемещений в метрах.
- **Расчёт метрик матча:**  
  Вычисление владения мячом, пройденного расстояния, интенсивности матча (км/мин) и, опционально, xG.
- **Веб-интерфейс:**  
  Приложение на Streamlit для интерактивного анализа видео.

## Структура проекта

football_analysis/
- data/
  - input_videos/ # Входные видео
  - output_videos/ # Выходные видео и изображения 
- functions/
  - tracker.py # Модуль трекинга объектов
  - camera_movement_estimator.py # Оценка движения камеры
  - view_transformer.py # Перспективное преобразование
  - speed_and_distance_estimator.py # Расчёт скорости и пройденного расстояния
  - team_assigner.py # Определение принадлежности к командам (KMeans)
  - player_ball_assigner.py # Определение владения мячом
  - xg_calculator.py # (Опционально) Расчёт xG
- stubs/
  - track_stubs.pkl # Stub для треков
  - camera_movement_stub.pkl # Stub для движения камеры 
- utils/
  - video_utils.py # Чтение и сохранение видео
  - bbox_utils.py # Функции для работы с bounding box
  - process_video.py # Основной пайплайн обработки видео и вычисления метрик
- streamlit_app.py # Веб-интерфейс на базе Streamlit 
- README.md # Документация проекта

## Modules Used
The following modules are used in this project:
- YOLO: AI object detection model
- Kmeans: Pixel segmentation and clustering to detect t-shirt color
- Optical Flow: Measure camera movement
- Perspective Transformation: Represent scene depth and perspective
- Speed and distance calculation per player

## Требования
Чтобы запустить проект, необходимо установить:
- Python 3.x
- ultralytics
- supervision
- OpenCV
- NumPy
- Pandas
- scikit-learn
- Streamlit

Установку зависимостей можно выполнить, создав файл `requirements.txt` и запустив:
```bash
pip install -r requirements.txt
```

## Как запустить проект

### Запуск через Streamlit

1. Откройте терминал в корневой папке проекта.
2. Выполните следующую команду:
   ```bash
   streamlit run streamlit_app.py
    ```
## Запуск из командной строки

### Для запуска основного пайплайна обработки видео выполните:

```bash
python utils/process_video.py

```

# Предупреждение

- Обязательно создать папку models и data с подпапками input_videos и output_videos
- В папку models нужно положить собственный модель
- В папки дата нужно положить входные данные
